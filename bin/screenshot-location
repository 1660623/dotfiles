#!/usr/bin/env elixir

# Changes the default location for storing screenshots using the OS X keyboard commands.
#
# From: http://osxdaily.com/2011/01/26/change-the-screenshot-save-file-location-in-mac-os-x/

defmodule Defaults do
  def read(args) do
    {output, 0} = System.cmd("defaults", ["read"] ++ OptionParser.split(args))
    output
  end

  def write(args) do
    {output, 0} = System.cmd("defaults", ["write"] ++ OptionParser.split(args))
    output
  end
end

defmodule ScreenshotLocation do
  def execute([default: true], _), do: write_location("~/Desktop")
  def execute(_, [location | _]), do: write_location(location)
  def execute(_, _), do: read_location

  defp read_location do
    IO.write Defaults.read("com.apple.screencapture location")
  end

  defp write_location(location) do
    location = Path.expand(location)
    IO.write Defaults.write("com.apple.screencapture location #{location}/")
  end
end

{options, args, _} = OptionParser.parse(System.argv(), strict: [default: :boolean])
ScreenshotLocation.execute(options, args)
