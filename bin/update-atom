#!/usr/bin/env ruby

require 'json'

def call_api(url)
  JSON.parse(`curl -s #{url}`)
end

def latest_release
  call_api('https://api.github.com/repos/atom/atom/releases')[0]
end

asset = latest_release['assets'].find { |a| a['name'] == 'atom-amd64.deb' }
url = asset['browser_download_url']

raise StandardError, "Could not download #{url}" unless system("wget #{url}")
system('sudo dpkg --install atom-amd64.deb')

File.unlink('atom-amd64.deb') if File.exist?('atom-amd64.deb')
