#!/usr/bin/env ruby

require 'octokit'

shipping_packages = [
  'atom/about',
  'atom/archive-view',
  'atom/async',
  'atom/atom-dark-syntax',
  'atom/atom-dark-ui',
  'atom/atom-keymap',
  'atom/atom-light-syntax',
  'atom/atom-light-ui',
  'atom/atom-ui',
  'atom/autocomplete-atom-api',
  'atom/autocomplete-css',
  'atom/autocomplete-html',
  'atom/autocomplete-plus',
  'atom/autocomplete-snippets',
  'atom/autoflow',
  'atom/autosave',
  'atom/babel-core',
  'atom/background-tips',
  'atom/base16-tomorrow-dark-theme',
  'atom/base16-tomorrow-light-theme',
  'atom/bookmarks',
  'atom/bracket-matcher',
  'atom/cached-run-in-this-context',
  'atom/chai',
  'atom/clear-cut',
  'atom/coffee-script',
  'atom/color',
  'atom/command-palette',
  'atom/dedent',
  'atom/deprecation-cop',
  'atom/dev-live-reload',
  'atom/devtron',
  'atom/encoding-selector',
  'atom/event-kit',
  'atom/exception-reporting',
  'atom/find-and-replace',
  'atom/find-parent-dir',
  'atom/first-mate',
  'atom/fs-plus',
  'atom/fstream',
  'atom/fuzzaldrin',
  'atom/fuzzy-finder',
  'atom/git-diff',
  'atom/git-utils',
  'atom/go-to-line',
  'atom/grammar-selector',
  'atom/grim',
  'atom/image-view',
  'atom/incompatible-packages',
  'atom/jasmine-json',
  'atom/jasmine-tagged',
  'atom/jquery',
  'atom/key-path-helpers',
  'atom/keybinding-resolver',
  'atom/language-c',
  'atom/language-clojure',
  'atom/language-coffee-script',
  'atom/language-csharp',
  'atom/language-css',
  'atom/language-gfm',
  'atom/language-git',
  'atom/language-go',
  'atom/language-html',
  'atom/language-hyperlink',
  'atom/language-java',
  'atom/language-javascript',
  'atom/language-json',
  'atom/language-less',
  'atom/language-make',
  'atom/language-mustache',
  'atom/language-objective-c',
  'atom/language-perl',
  'atom/language-php',
  'atom/language-property-list',
  'atom/language-python',
  'atom/language-ruby-on-rails',
  'atom/language-ruby',
  'atom/language-sass',
  'atom/language-shellscript',
  'atom/language-source',
  'atom/language-sql',
  'atom/language-text',
  'atom/language-todo',
  'atom/language-toml',
  'atom/language-xml',
  'atom/language-yaml',
  'atom/less-cache',
  'atom/line-ending-selector',
  'atom/line-top-index',
  'atom/link',
  'atom/markdown-preview',
  'atom/marked',
  'atom/metrics',
  'atom/mocha',
  'atom/normalize-package-data',
  'atom/notifications',
  'atom/nslog',
  'atom/one-dark-syntax',
  'atom/one-dark-ui',
  'atom/one-light-syntax',
  'atom/one-light-ui',
  'atom/oniguruma',
  'atom/open-on-github',
  'atom/package-generator',
  'atom/pathwatcher',
  'atom/property-accessors',
  'atom/random-words',
  'atom/resolve',
  'atom/runas',
  'atom/scandal',
  'atom/scoped-property-store',
  'atom/scrollbar-style',
  'atom/season',
  'atom/semver',
  'atom/service-hub',
  'atom/settings-view',
  'atom/sinon',
  'atom/snippets',
  'atom/solarized-dark-syntax',
  'atom/solarized-light-syntax',
  'atom/source-map-support',
  'atom/spell-check',
  'atom/status-bar',
  'atom/styleguide',
  'atom/symbols-view',
  'atom/tabs',
  'atom/temp',
  'atom/text-buffer',
  'atom/timecop',
  'atom/tree-view',
  'atom/typescript-simple',
  'atom/underscore-plus',
  'atom/update-package-dependencies',
  'atom/welcome',
  'atom/whitespace',
  'atom/winreg',
  'atom/wrap-guide',
  'atom/yargs'
]

token_path = File.join(ENV['HOME'], '.github')

token_file = File.join(token_path, File.basename(__FILE__))
token_file = File.join(token_path, 'default_token') unless File.exist?(token_file)
token = File.read(token_file).strip

client = Octokit::Client.new(access_token: token)
client.auto_paginate = true

org = ARGV[0]

repos = client.repositories(org)

repos.each do |repo|
  name = repo.full_name
  issues = client.issues(name)
  pull_requests = client.pull_requests(name)
  shipping = shipping_packages.include?(name)

  puts "#{name},#{shipping},#{issues.count},#{pull_requests.count}"
end
